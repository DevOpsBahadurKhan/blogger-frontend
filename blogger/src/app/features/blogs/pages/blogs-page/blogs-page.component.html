<div class="blogs-page">
  <div class="header">
    <h2>
      <mat-icon>rss_feed</mat-icon>
      Blogs
    </h2>
    <div class="actions">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search posts</mat-label>
        <input matInput placeholder="Search by title or author" [(ngModel)]="search" />
        <button *ngIf="search" matSuffix mat-icon-button aria-label="Clear" (click)="search=''">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <mat-spinner diameter="40"></mat-spinner>
  </div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="!loading" class="cards" data-testid="blog-cards">
    <mat-card *ngFor="let b of filteredBlogs; trackBy: trackById" class="blog-card">
      <mat-card-header>
        <div mat-card-avatar class="avatar">
          {{ (b.author?.username || 'U')[0] | uppercase }}
        </div>
        <mat-card-title>{{ b.title }}</mat-card-title>
        <mat-card-subtitle>
          by {{ b.author?.username || 'Unknown' }} Â· {{ b.createdAt | date:'mediumDate' }}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p class="excerpt">{{ b.content || '' | slice:0:180 }}<span *ngIf="(b.content||'').length>180">...</span></p>
      </mat-card-content>
      <mat-card-actions>
        <a mat-button color="primary" [routerLink]="['/blogs', b.id]">
          <mat-icon>open_in_new</mat-icon>
          Read more
        </a>
      </mat-card-actions>
    </mat-card>
  </div>

  <div *ngIf="!loading && !filteredBlogs.length" class="empty">
    <mat-icon>hourglass_empty</mat-icon>
    <span>No posts found.</span>
  </div>
</div>